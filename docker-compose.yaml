services:
  sqlserver:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: sqlserver_db
    environment:
      - ACCEPT_EULA=Y
      - MSSQL_SA_PASSWORD=P@ssword123!
    ports:
      - "1433:1433"

  db-init:
    image: mcr.microsoft.com/mssql/server:2022-latest
    depends_on:
      - sqlserver
    # We use 'sh -c' to ensure the Linux shell handles the sleep and echo,
    # and only passes the specific string to sqlcmd.
    command: >
      sh -c "sleep 20 && 
      /opt/mssql-tools18/bin/sqlcmd -S sqlserver -U sa -P 'P@ssword123!' -C -Q 'IF NOT EXISTS (SELECT * FROM sys.databases WHERE name = \"EcommerceDB\") CREATE DATABASE EcommerceDB;' && 
      echo 'Database EcommerceDB is ready!'"
